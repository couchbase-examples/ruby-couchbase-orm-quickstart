<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorial-ruby-couchbase-orm/views" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Views (aka Map/Reduce indexes) | Ruby Couchbase ORM</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ruby-cb-orm.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ruby-cb-orm.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ruby-cb-orm.com/docs/tutorial-ruby-couchbase-orm/views"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Views (aka Map/Reduce indexes) | Ruby Couchbase ORM"><meta data-rh="true" name="description" content="Views are a powerful feature in Couchbase that allow you to define map functions to extract and emit specific data from your documents. The Ruby Couchbase ORM provides a convenient way to define and query views within your Ruby application."><meta data-rh="true" property="og:description" content="Views are a powerful feature in Couchbase that allow you to define map functions to extract and emit specific data from your documents. The Ruby Couchbase ORM provides a convenient way to define and query views within your Ruby application."><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://ruby-cb-orm.com/docs/tutorial-ruby-couchbase-orm/views"><link data-rh="true" rel="alternate" href="https://ruby-cb-orm.com/docs/tutorial-ruby-couchbase-orm/views" hreflang="en"><link data-rh="true" rel="alternate" href="https://ruby-cb-orm.com/docs/tutorial-ruby-couchbase-orm/views" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5d3acf1b.css">
<script src="/assets/js/runtime~main.3c5e2ced.js" defer="defer"></script>
<script src="/assets/js/main.a4a80bed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Ruby Couchbase ORM Tutorial Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Ruby Couchbase ORM Tutorial Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ruby Couchbase ORM</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/tutorial---ruby-couchbase-orm">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Couchbase-Ecosystem/ruby-orm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/tutorial---ruby-couchbase-orm">Tutorial - Ruby Couchbase ORM</a><button aria-label="Collapse sidebar category &#x27;Tutorial - Ruby Couchbase ORM&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/defining-models">Defining Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/querying">Querying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/persistence">Persistence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/associations-and-validations">Associations and Validations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/sqlpp-queries">SQL++ (formerly N1QL) Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/views">Views (aka Map/Reduce indexes)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/nested-documents">Nested Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/enums">Enums</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/encryption">Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorial-ruby-couchbase-orm/troubleshooting">Troubleshooting</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/tutorial---ruby-couchbase-orm"><span itemprop="name">Tutorial - Ruby Couchbase ORM</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Views (aka Map/Reduce indexes)</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Views (aka Map/Reduce indexes)</h1>
<p>Views are a powerful feature in Couchbase that allow you to define map functions to extract and emit specific data from your documents. The Ruby Couchbase ORM provides a convenient way to define and query views within your Ruby application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="81-defining-views">8.1 Defining Views<a class="hash-link" aria-label="Direct link to 8.1 Defining Views" title="Direct link to 8.1 Defining Views" href="/docs/tutorial-ruby-couchbase-orm/views#81-defining-views">​</a></h2>
<p>To define a view in your Ruby Couchbase ORM model, you can use the <code>view</code> method followed by the view name and options. Here&#x27;s an example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Factory &lt; CouchbaseOrm::Base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute :name, type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute :location, type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute :established_year, type: Integer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute :active, type: Boolean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_name, emit_key: :name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_location, emit_key: :location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_established_year, emit_key: :established_year</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_active, emit_key: :active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, we define four views for the <code>Factory</code> model:</p>
<ul>
<li><code>by_name</code>: Emits the <code>name</code> attribute as the key.</li>
<li><code>by_location</code>: Emits the <code>location</code> attribute as the key.</li>
<li><code>by_established_year</code>: Emits the <code>established_year</code> attribute as the key.</li>
<li><code>by_active</code>: Emits the <code>active</code> attribute as the key.</li>
</ul>
<p>The <code>emit_key</code> option specifies the attribute to use as the key for the view.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="82-custom-map-functions">8.2 Custom Map Functions<a class="hash-link" aria-label="Direct link to 8.2 Custom Map Functions" title="Direct link to 8.2 Custom Map Functions" href="/docs/tutorial-ruby-couchbase-orm/views#82-custom-map-functions">​</a></h2>
<p>You can also define custom map functions for your views using the <code>map</code> option. This allows you to emit custom keys and values based on your specific requirements. Here&#x27;s an example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">view :by_name_and_location,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map: %{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    function(doc) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (doc.type === &quot;factory&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emit([doc.name, doc.location], null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, we define a view named <code>by_name_and_location</code> that emits a composite key consisting of the <code>name</code> and <code>location</code> attributes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="83-querying-views">8.3 Querying Views<a class="hash-link" aria-label="Direct link to 8.3 Querying Views" title="Direct link to 8.3 Querying Views" href="/docs/tutorial-ruby-couchbase-orm/views#83-querying-views">​</a></h2>
<p>Once you have defined your views, you can query them using the corresponding view methods. The view methods are automatically generated based on the view names. Here are some examples:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Query factories by name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Factory.by_name(key: &#x27;Factory A&#x27;).each do |factory|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  puts &quot;- #{factory.name}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Query factories by location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Factory.by_location(key: &#x27;City X&#x27;).each do |factory|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  puts &quot;- #{factory.name}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Query factories by established year</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Factory.by_established_year(key: 2010).each do |factory|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  puts &quot;- #{factory.name}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Query active factories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Factory.by_active(key: true).each do |factory|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  puts &quot;- #{factory.name}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These examples demonstrate how to query views based on specific keys using the generated view methods.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="84-indexing-views">8.4 Indexing Views<a class="hash-link" aria-label="Direct link to 8.4 Indexing Views" title="Direct link to 8.4 Indexing Views" href="/docs/tutorial-ruby-couchbase-orm/views#84-indexing-views">​</a></h2>
<p>In this section, let&#x27;s explore the <code>index_view</code> function and the methods it generates for the <code>location</code> attribute.</p>
<p>Here&#x27;s an updated version of the <code>Factory</code> model using <code>index_view</code> for the <code>location</code> attribute:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Factory &lt; CouchbaseOrm::Base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute :name, type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute :location, type: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute :established_year, type: Integer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute :active, type: Boolean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_name, emit_key: :name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  index_view :location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_established_year, emit_key: :established_year</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_active, emit_key: :active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_name_and_location,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    map: %{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      function(doc) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (doc.type === &quot;factory&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          emit([doc.name, doc.location], null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  view :by_established_year_range,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    map: %{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      function(doc) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (doc.type === &quot;factory&quot; &amp;&amp; doc.established_year) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          emit(doc.established_year, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this updated code, we replaced <code>view :by_location, emit_key: :location</code> with <code>index_view :location</code>. The <code>index_view</code> function generates two methods for querying based on the <code>location</code> attribute:</p>
<ol>
<li>
<p><code>find_by_location(location)</code>: This method allows you to find factories by a specific location. It returns an array of factories that match the given location.</p>
</li>
<li>
<p><code>by_location(key: location)</code>: This method is similar to <code>find_by_location</code> but returns a <code>CouchbaseOrm::ResultsProxy</code> object, which provides an enumerable interface to access the view results.</p>
</li>
</ol>
<p>Now, let&#x27;s see how we can use these generated methods to query factories by location:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Find factories by location using find_by_location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">factories = Factory.find_by_location(&#x27;City X&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">factories.each do |factory|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  puts &quot;- #{factory.name} (#{factory.location})&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Find factories by location using by_location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Factory.by_location(key: &#x27;City X&#x27;).each do |factory|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  puts &quot;- #{factory.name} (#{factory.location})&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Both <code>find_by_location</code> and <code>by_location</code> achieve the same result of finding factories by a specific location. The difference is that <code>find_by_location</code> returns an array of factories directly, while <code>by_location</code> returns a <code>CouchbaseOrm::ResultsProxy</code> object that you can further chain or iterate over.</p>
<p>Using <code>index_view</code> provides a convenient way to generate commonly used query methods for a specific attribute. It simplifies the process of querying based on that attribute and enhances the readability of your code.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="85-conclusion">8.5 Conclusion<a class="hash-link" aria-label="Direct link to 8.5 Conclusion" title="Direct link to 8.5 Conclusion" href="/docs/tutorial-ruby-couchbase-orm/views#85-conclusion">​</a></h2>
<p>Views in the Ruby Couchbase ORM provide a powerful way to define and query data based on specific attributes and custom map functions. By defining views, you can easily retrieve subsets of your data and perform efficient queries based on your application&#x27;s requirements.</p>
<p>Remember to ensure that your design documents are up to date by calling <code>ensure_design_document!</code> on your models before running queries.</p>
<p>With the flexibility and ease of use provided by the Ruby Couchbase ORM&#x27;s view functionality, you can efficiently query and retrieve data from your Couchbase database.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/couchbase-examples/ruby-couchbase-orm-quickstart/tree/docs/docusaurus/docusaurus/docs/docs/tutorial-ruby-couchbase-orm/08-views.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorial-ruby-couchbase-orm/sqlpp-queries"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SQL++ (formerly N1QL) Queries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorial-ruby-couchbase-orm/nested-documents"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Nested Documents</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/tutorial-ruby-couchbase-orm/views#81-defining-views">8.1 Defining Views</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/tutorial-ruby-couchbase-orm/views#82-custom-map-functions">8.2 Custom Map Functions</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/tutorial-ruby-couchbase-orm/views#83-querying-views">8.3 Querying Views</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/tutorial-ruby-couchbase-orm/views#84-indexing-views">8.4 Indexing Views</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/tutorial-ruby-couchbase-orm/views#85-conclusion">8.5 Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/couchbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://bit.ly/3JGCeUg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/couchbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Couchbase-Ecosystem/couchbase-ruby-orm" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Couchbase, Inc. Licensed under the Apache License, Version 2.0.</div></div></div></footer></div>
</body>
</html>