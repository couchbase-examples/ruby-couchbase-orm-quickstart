# Logging

CouchbaseOrm provides a logging mechanism to help you monitor and debug your application. Logging allows you to capture important events, errors, and information during the execution of your application. CouchbaseOrm integrates with the logging framework used in your Ruby application, such as the built-in `Logger` class or third-party logging libraries.

## 12.1. Configuring Logging

By default, CouchbaseOrm uses the `Logger` class from the Ruby standard library for logging. The default log level is set to `INFO`, which means that informational messages and above (warn, error, fatal) will be logged.

You can configure the logger used by CouchbaseOrm by setting the `logger` option:

```ruby
CouchbaseOrm.configure do |config|
  config.logger = Logger.new(STDOUT)
end
```

In this example, we configure CouchbaseOrm to use a new instance of the `Logger` class that logs messages to the standard output (STDOUT).

You can also specify a different logger, such as a file logger or a third-party logging library:

```ruby
CouchbaseOrm.configure do |config|
  config.logger = Logger.new('couchbase_orm.log')
end
```

This configuration sets the logger to write log messages to a file named `couchbase_orm.log`.

## 12.2. Log Levels

CouchbaseOrm supports different log levels to control the verbosity of the logged messages. The available log levels, in increasing order of severity, are:

- `DEBUG`: Detailed information, typically of interest only when diagnosing problems.
- `INFO`: Confirmation that things are working as expected.
- `WARN`: An indication that something unexpected happened or indicative of some problem in the near future.
- `ERROR`: Due to a more serious problem, the software has not been able to perform some function.
- `FATAL`: A serious error, indicating that the program itself may be unable to continue running.

By default, CouchbaseOrm logs messages at the `INFO` level and above. You can change the log level by setting the `log_level` option:

```ruby
CouchbaseOrm.configure do |config|
  config.log_level = :debug
end
```

In this example, we set the log level to `:debug`, which means that all log messages, including detailed debug information, will be logged.

## 12.3. Logging Messages

CouchbaseOrm logs various messages throughout its operation, such as database queries, document saves, and errors. These log messages provide insights into the behavior of your application and can be useful for debugging and monitoring purposes.

Here are some examples of log messages generated by CouchbaseOrm:

```
[CouchbaseOrm] [INFO] Executing N1QL query: SELECT * FROM users WHERE type = 'User' AND status = 'active'
[CouchbaseOrm] [DEBUG] Saving document: {"type":"User","name":"John Doe","email":"john@example.com"}
[CouchbaseOrm] [ERROR] Error while saving document: Couchbase::Error::DocumentExists: The specified document already exists
```

These log messages include the log level, the message itself, and any relevant contextual information.

## 12.4. Custom Logging

In addition to the built-in logging provided by CouchbaseOrm, you can add your own custom log messages to provide application-specific logging.

You can access the configured logger using the `CouchbaseOrm.logger` method and use it to log custom messages:

```ruby
CouchbaseOrm.logger.info "User registration successful"
CouchbaseOrm.logger.debug "User attributes: #{user.attributes}"
CouchbaseOrm.logger.error "Failed to send email notification"
```

By leveraging the configured logger, you can ensure that your custom log messages are logged consistently with the CouchbaseOrm log messages.

## 12.5. Logging in Production

In a production environment, it's important to consider the performance and storage implications of logging. Logging too much information or logging at a very detailed level can impact the performance of your application and consume significant storage space.

Here are some best practices for logging in a production environment:

- Set the log level to `INFO` or higher to avoid logging excessive debug information.
- Use a rotating file logger or a log management service to prevent log files from growing too large.
- Monitor the log files regularly and set up alerts for critical errors or unusual patterns.
- Consider using a centralized logging solution to aggregate and analyze logs from multiple instances or services.

Remember, logs are not only useful for debugging but also for monitoring the health and performance of your application. By properly configuring and managing logging, you can gain valuable insights into the behavior of your application and quickly identify and resolve issues.

## 12.6. Logging Configuration per Environment

In most applications, you'll want to have different logging configurations for different environments, such as development, testing, and production. CouchbaseOrm allows you to configure logging settings specific to each environment.

For example, in a Rails application, you can configure logging in the respective environment configuration files:

```ruby
# config/environments/development.rb
config.couchbase_orm.logger = Logger.new(STDOUT)
config.couchbase_orm.log_level = :debug

# config/environments/production.rb
config.couchbase_orm.logger = Logger.new('log/couchbase_orm.log', 10, 100.megabytes)
config.couchbase_orm.log_level = :info
```

In this example, the development environment logs to the standard output with a log level of `:debug`, while the production environment logs to a file with log rotation and a log level of `:info`.

By configuring logging per environment, you can ensure that you have the appropriate level of logging for each environment, balancing the need for detailed information during development and the performance and storage considerations in production.

Logging is an essential tool for monitoring, debugging, and understanding the behavior of your application. CouchbaseOrm provides a flexible logging mechanism that integrates with the logging framework of your choice, allowing you to capture and analyze important events and information throughout your application's lifecycle.

In the next section, we'll explore testing with CouchbaseOrm and how you can write effective tests for your models and queries.
