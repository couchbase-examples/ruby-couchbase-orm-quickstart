"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[350],{6404:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var t=n(4848),s=n(8453);const o={},a="Querying",i={id:"tutorial-ruby-couchbase-orm/querying",title:"Querying",description:"CouchbaseOrm provides a powerful and expressive query interface for retrieving data from Couchbase Server. With CouchbaseOrm, you can easily construct queries using a fluent and intuitive API that resembles the querying capabilities of ActiveRecord.",source:"@site/docs/tutorial-ruby-couchbase-orm/04-querying.md",sourceDirName:"tutorial-ruby-couchbase-orm",slug:"/tutorial-ruby-couchbase-orm/querying",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/querying",draft:!1,unlisted:!1,editUrl:"https://github.com/couchbase-examples/ruby-couchbase-orm-quickstart/tree/docs/docusaurus/docusaurus/docs/docs/tutorial-ruby-couchbase-orm/04-querying.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Defining Models",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/defining-models"},next:{title:"Persistence",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/persistence"}},c={},d=[{value:"4.1. Finding Records",id:"41-finding-records",level:2},{value:"4.2. Where Clauses",id:"42-where-clauses",level:2},{value:"4.3. Ordering",id:"43-ordering",level:2},{value:"4.4. Pluck",id:"44-pluck",level:2},{value:"4.5. Destroying Records",id:"45-destroying-records",level:2},{value:"4.6. Scopes",id:"46-scopes",level:2}];function u(e){const r={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{id:"querying",children:"Querying"}),"\n",(0,t.jsx)(r.p,{children:"CouchbaseOrm provides a powerful and expressive query interface for retrieving data from Couchbase Server. With CouchbaseOrm, you can easily construct queries using a fluent and intuitive API that resembles the querying capabilities of ActiveRecord."}),"\n",(0,t.jsx)(r.h2,{id:"41-finding-records",children:"4.1. Finding Records"}),"\n",(0,t.jsx)(r.p,{children:"CouchbaseOrm offers various methods to find records based on different criteria. Here are some commonly used methods:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"find"}),": Finds a record by its primary key (ID)."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"find_by"}),": Finds the first record that matches the specified attribute-value pair."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"where"}),": Retrieves records that match the specified conditions."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"Here are some examples of finding records:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ruby",children:"# Define an Author model\nclass Author < CouchbaseOrm::Base\n  attribute :name, :string\n  attribute :age, :integer\n  attribute :active, :boolean, default: true\n\n  validates :name, presence: true\n  validates :age, numericality: { greater_than_or_equal_to: 18 }\n\nend\n\n# Create new authors\nauthor1 = Author.new(name: 'John Doe', age: 30, active: true)\nauthor2 = Author.new(name: 'Jane Smith', age: 25, active: false)\nauthor3 = Author.new(name: 'Alice Brown', age: 40, active: true)\nauthor4 = Author.new(name: 'Bob Johnson', age: 17, active: true)\n\n# Save authors\nauthor1.save\nauthor2.save\nauthor3.save\nauthor4.save\n\n# Find authors by ID\nputs Author.find(author1.id).inspect\n\n# Find the first author with a specific name\nputs Author.find_by(name: 'John Doe').inspect\n\n# Where\nputs Author.where(active: true).to_a.inspect\n"})}),"\n",(0,t.jsx)(r.h2,{id:"42-where-clauses",children:"4.2. Where Clauses"}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"where"})," method allows you to specify conditions to filter the records based on attribute values. You can chain multiple ",(0,t.jsx)(r.code,{children:"where"})," clauses together to build more complex queries."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ruby",children:"# Where\nputs Author.where(active: true).where('age >= 30').to_a.inspect\n\nputs Author.where(\"name like '%John%'\").to_a.inspect\n"})}),"\n",(0,t.jsxs)(r.p,{children:["CouchbaseOrm supports various comparison operators and placeholders in the ",(0,t.jsx)(r.code,{children:"where"})," clauses, such as ",(0,t.jsx)(r.code,{children:"="}),", ",(0,t.jsx)(r.code,{children:">"}),", ",(0,t.jsx)(r.code,{children:"<"}),", ",(0,t.jsx)(r.code,{children:">="}),", ",(0,t.jsx)(r.code,{children:"<="}),", ",(0,t.jsx)(r.code,{children:"LIKE"}),", and more."]}),"\n",(0,t.jsx)(r.h2,{id:"43-ordering",children:"4.3. Ordering"}),"\n",(0,t.jsxs)(r.p,{children:["You can specify the order in which the retrieved records should be sorted using the ",(0,t.jsx)(r.code,{children:"order"})," method. Pass the attribute name and the desired sort direction (",(0,t.jsx)(r.code,{children:":asc"})," for ascending, ",(0,t.jsx)(r.code,{children:":desc"})," for descending)."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ruby",children:"# Order authors by name\nputs Author.order(:name).to_a.inspect\n\n# Order authors by age in descending order\nputs Author.order(age: :desc).to_a.inspect\n"})}),"\n",(0,t.jsxs)(r.p,{children:["You can also chain multiple ",(0,t.jsx)(r.code,{children:"order"})," clauses to sort by multiple attributes."]}),"\n",(0,t.jsx)(r.p,{children:"Scopes provide a clean and DRY way to encapsulate commonly used query conditions."}),"\n",(0,t.jsx)(r.h2,{id:"44-pluck",children:"4.4. Pluck"}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"pluck"})," method allows you to retrieve specific attributes from the matched records instead of loading the entire objects. It returns an array of values for the specified attributes."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ruby",children:"# Pluck names of all authors\nputs Author.order(:name).pluck(:name).inspect\n"})}),"\n",(0,t.jsx)(r.h2,{id:"45-destroying-records",children:"4.5. Destroying Records"}),"\n",(0,t.jsxs)(r.p,{children:["To delete multiple records that match specific conditions, you can use the ",(0,t.jsx)(r.code,{children:".each(&:destroy)"})," method. It deletes the records from the database and returns the number of records deleted."]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:":destroy"}),": Deletes a single record."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"delete_all"}),": Deletes all records that match the specified conditions."]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ruby",children:"# Destroy all inactive authors\nAuthor.where(active: false).each(&:destroy)\n\n# Destroy all authors who are inactive\nAuthor.where(active: false).delete_all\n\n"})}),"\n",(0,t.jsx)(r.p,{children:"These are just a few examples of the querying capabilities provided by CouchbaseOrm. You can combine these methods in various ways to construct complex and specific queries based on your application's requirements."}),"\n",(0,t.jsx)(r.p,{children:"In the next section, we'll explore how to use CouchbaseOrm to create, update, and delete records in Couchbase Server."}),"\n",(0,t.jsx)(r.h2,{id:"46-scopes",children:"4.6. Scopes"}),"\n",(0,t.jsx)(r.p,{children:"Scopes allow you to define reusable query snippets that can be chained with other query methods. Scopes are defined as class methods within your model."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ruby",children:"# Define a Comment model\nclass Comment < CouchbaseOrm::Base\n  attribute :title, :string\n  attribute :author, :string\n  attribute :category, :string\n  attribute :ratings, :integer\n\n  def self.by_author(author)\n    where(author: author)\n  end\n\n  def self.highly_rated\n    where('ratings > 3')\n  end\n\n  def self.in_category(category)\n    where(category: category)\n  end\nend\n\n\n# Create some comments\ncomment1 = Comment.new(title: 'First Comment', author: 'Anne McCaffrey', category: 'S-F', ratings: 5)\ncomment2 = Comment.new(title: 'Second Comment', author: 'Anne McCaffrey', category: 'S-F', ratings: 4)\ncomment3 = Comment.new(title: 'Third Comment', author: 'Anne McCaffrey', category: 'S-F', ratings: 3)\ncomment4 = Comment.new(title: 'Fourth Comment', author: 'Anne McCaffrey', category: 'S-F', ratings: 2)\n\n# Save the comments\ncomment1.save\ncomment2.save\ncomment3.save\ncomment4.save\n\n# Example usage of scopes\ncomments = Comment.by_author(\"Anne McCaffrey\").in_category('S-F').highly_rated.order(:title).limit(10)\n\n# Iterate over the comments\ncomments.each do |comment|\n  puts \"Title: #{comment.title}, Author: #{comment.author}, Category: #{comment.category}, Ratings: #{comment.ratings}\"\nend\n"})})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>i});var t=n(6540);const s={},o=t.createContext(s);function a(e){const r=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);