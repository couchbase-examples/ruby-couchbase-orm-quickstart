"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6235],{2954:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>u,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>c});var n=r(4848),i=r(8453);const a={sidebar_position:7},o="N1QL Queries",t={id:"tutorial-ruby-couchbase-orm/n1ql-queries",title:"N1QL Queries",description:"CouchbaseOrm provides support for executing N1QL queries directly from your Ruby code. N1QL (Non-First Normal Form Query Language) is a powerful query language that allows you to perform complex queries and aggregations on your Couchbase data.",source:"@site/docs/tutorial-ruby-couchbase-orm/07-n1ql-queries.md",sourceDirName:"tutorial-ruby-couchbase-orm",slug:"/tutorial-ruby-couchbase-orm/n1ql-queries",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/n1ql-queries",draft:!1,unlisted:!1,editUrl:"https://github.com/couchbase-examples/ruby-couchbase-orm-quickstart/tree/docs/docusaurus/docusaurus/docs/docs/tutorial-ruby-couchbase-orm/07-n1ql-queries.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Associations and Validations",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/associations-and-validations"},next:{title:"Views",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/views"}},u={},c=[{value:"7.1. Defining N1QL Queries",id:"71-defining-n1ql-queries",level:2},{value:"7.2. Query Parameters",id:"72-query-parameters",level:2},{value:"7.3. Executing N1QL Queries",id:"73-executing-n1ql-queries",level:2},{value:"7.4. Query Options",id:"74-query-options",level:2},{value:"7.5. Placeholder Values",id:"75-placeholder-values",level:2},{value:"7.6. Query Result Processing",id:"76-query-result-processing",level:2},{value:"7.7. Indexing for N1QL",id:"77-indexing-for-n1ql",level:2}];function l(e){const s={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"n1ql-queries",children:"N1QL Queries"}),"\n",(0,n.jsx)(s.p,{children:"CouchbaseOrm provides support for executing N1QL queries directly from your Ruby code. N1QL (Non-First Normal Form Query Language) is a powerful query language that allows you to perform complex queries and aggregations on your Couchbase data."}),"\n",(0,n.jsx)(s.h2,{id:"71-defining-n1ql-queries",children:"7.1. Defining N1QL Queries"}),"\n",(0,n.jsxs)(s.p,{children:["To define an N1QL query in your model, you can use the ",(0,n.jsx)(s.code,{children:"n1ql"})," class method provided by CouchbaseOrm."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  n1ql :find_by_email, 'SELECT * FROM users WHERE email = $1'\nend\n"})}),"\n",(0,n.jsxs)(s.p,{children:["In this example, we define an N1QL query named ",(0,n.jsx)(s.code,{children:"find_by_email"})," that selects all users with a specific email address. The ",(0,n.jsx)(s.code,{children:"$1"})," placeholder represents a parameter that will be provided when executing the query."]}),"\n",(0,n.jsx)(s.h2,{id:"72-query-parameters",children:"7.2. Query Parameters"}),"\n",(0,n.jsx)(s.p,{children:"N1QL queries often require parameters to be passed in order to filter or customize the results. CouchbaseOrm allows you to define queries with placeholders and provide the parameter values when executing the query."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  n1ql :find_by_name_and_age, 'SELECT * FROM users WHERE name = $1 AND age >= $2'\nend\n\nusers = User.find_by_name_and_age('John', 25)\n"})}),"\n",(0,n.jsxs)(s.p,{children:["In this example, the ",(0,n.jsx)(s.code,{children:"find_by_name_and_age"})," query takes two parameters: the name and the minimum age. The ",(0,n.jsx)(s.code,{children:"$1"})," and ",(0,n.jsx)(s.code,{children:"$2"})," placeholders represent these parameters, respectively. When executing the query, we provide the actual values for the name and age."]}),"\n",(0,n.jsx)(s.h2,{id:"73-executing-n1ql-queries",children:"7.3. Executing N1QL Queries"}),"\n",(0,n.jsx)(s.p,{children:"To execute an N1QL query, you simply call the defined query method on your model class."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-ruby",children:"users = User.find_by_email('john@example.com')\n"})}),"\n",(0,n.jsx)(s.p,{children:"CouchbaseOrm automatically executes the N1QL query and returns the result set as an array of model instances."}),"\n",(0,n.jsx)(s.h2,{id:"74-query-options",children:"7.4. Query Options"}),"\n",(0,n.jsx)(s.p,{children:"CouchbaseOrm provides various options to customize the execution of N1QL queries. These options can be passed as a hash parameter to the query method."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-ruby",children:"users = User.find_by_name_and_age('John', 25, limit: 10, consistency: :eventual)\n"})}),"\n",(0,n.jsx)(s.p,{children:"Some commonly used query options include:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"limit"}),": Specifies the maximum number of results to return."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"offset"}),": Specifies the number of results to skip before starting to return results."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"order_by"}),": Specifies the attribute(s) to sort the results by."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"consistency"}),": Specifies the consistency level for the query (",(0,n.jsx)(s.code,{children:"eventual"})," or ",(0,n.jsx)(s.code,{children:"request_plus"}),")."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"timeout"}),": Specifies the timeout value for the query in milliseconds."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"75-placeholder-values",children:"7.5. Placeholder Values"}),"\n",(0,n.jsxs)(s.p,{children:["In addition to using positional placeholders (",(0,n.jsx)(s.code,{children:"$1"}),", ",(0,n.jsx)(s.code,{children:"$2"}),", etc.), CouchbaseOrm also supports named placeholders for better readability."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  n1ql :find_by_name, 'SELECT * FROM users WHERE name = $name'\nend\n\nusers = User.find_by_name(name: 'John')\n"})}),"\n",(0,n.jsxs)(s.p,{children:["In this example, the ",(0,n.jsx)(s.code,{children:"$name"})," placeholder is used in the query, and the value is provided using a hash parameter with the corresponding key."]}),"\n",(0,n.jsx)(s.h2,{id:"76-query-result-processing",children:"7.6. Query Result Processing"}),"\n",(0,n.jsx)(s.p,{children:"By default, CouchbaseOrm automatically maps the query result to instances of your model class. However, you can also process the query result manually if needed."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  n1ql :count_by_age, 'SELECT COUNT(*) AS count FROM users WHERE age >= $1'\nend\n\nresult = User.count_by_age(18, raw: true)\ncount = result.first['count']\n"})}),"\n",(0,n.jsxs)(s.p,{children:["In this example, the ",(0,n.jsx)(s.code,{children:"count_by_age"})," query returns the count of users above a certain age. By passing the ",(0,n.jsx)(s.code,{children:"raw: true"})," option, CouchbaseOrm returns the raw query result instead of mapping it to model instances. We can then access the count value from the result hash."]}),"\n",(0,n.jsx)(s.h2,{id:"77-indexing-for-n1ql",children:"7.7. Indexing for N1QL"}),"\n",(0,n.jsx)(s.p,{children:"To optimize the performance of N1QL queries, it's important to create appropriate indexes on the fields used in the query conditions. Couchbase Server provides a way to create indexes using the Index service."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  index :email\n  index :age\nend\n"})}),"\n",(0,n.jsxs)(s.p,{children:["In this example, we define indexes on the ",(0,n.jsx)(s.code,{children:"email"})," and ",(0,n.jsx)(s.code,{children:"age"})," fields of the ",(0,n.jsx)(s.code,{children:"User"})," model. CouchbaseOrm automatically creates these indexes in Couchbase Server when the application starts or when the ",(0,n.jsx)(s.code,{children:"User.ensure_indexes!"})," method is called."]}),"\n",(0,n.jsx)(s.p,{children:"Indexing helps improve the efficiency of N1QL queries by allowing Couchbase Server to quickly locate the relevant documents based on the indexed fields."}),"\n",(0,n.jsx)(s.p,{children:"N1QL queries in CouchbaseOrm provide a powerful and flexible way to retrieve data from Couchbase Server. By leveraging the expressive power of N1QL, you can perform complex queries, aggregations, and data manipulations directly from your Ruby code."}),"\n",(0,n.jsx)(s.p,{children:"In the next section, we'll explore how to use views in CouchbaseOrm for data querying and indexing."})]})}function d(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>t});var n=r(6540);const i={},a=n.createContext(i);function o(e){const s=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);