"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[841],{8258:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>l,frontMatter:()=>r,metadata:()=>o,toc:()=>i});var a=n(4848),s=n(8453);const r={},d="Nested Documents",o={id:"tutorial-ruby-couchbase-orm/nested-documents",title:"Nested Documents",description:"CouchbaseOrm supports nested documents, which allow you to store complex, hierarchical data structures within a single Couchbase document. Nested documents are useful when you have related data that you want to store together with the parent document for performance or consistency reasons.",source:"@site/docs/tutorial-ruby-couchbase-orm/09-nested-documents.md",sourceDirName:"tutorial-ruby-couchbase-orm",slug:"/tutorial-ruby-couchbase-orm/nested-documents",permalink:"/docs/tutorial-ruby-couchbase-orm/nested-documents",draft:!1,unlisted:!1,editUrl:"https://github.com/couchbase-examples/ruby-couchbase-orm-quickstart/tree/docs/docusaurus/docusaurus/docs/docs/tutorial-ruby-couchbase-orm/09-nested-documents.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Views (aka Map/Reduce indexes)",permalink:"/docs/tutorial-ruby-couchbase-orm/views"},next:{title:"Enums",permalink:"/docs/tutorial-ruby-couchbase-orm/enums"}},c={},i=[{value:"9.1. Defining Nested Documents",id:"91-defining-nested-documents",level:2},{value:"9.2. Embedding Documents",id:"92-embedding-documents",level:2},{value:"9.3. Accessing Nested Documents",id:"93-accessing-nested-documents",level:2},{value:"9.4. Updating Nested Documents",id:"94-updating-nested-documents",level:2},{value:"9.5. Embedding Multiple Documents",id:"95-embedding-multiple-documents",level:2},{value:"9.6. Querying Nested Documents",id:"96-querying-nested-documents",level:2},{value:"9.7. Validating Nested Documents",id:"97-validating-nested-documents",level:2}];function u(e){const t={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"nested-documents",children:"Nested Documents"}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm supports nested documents, which allow you to store complex, hierarchical data structures within a single Couchbase document. Nested documents are useful when you have related data that you want to store together with the parent document for performance or consistency reasons."}),"\n",(0,a.jsx)(t.h2,{id:"91-defining-nested-documents",children:"9.1. Defining Nested Documents"}),"\n",(0,a.jsxs)(t.p,{children:["To define an nested document, you create a new class that inherits from ",(0,a.jsx)(t.code,{children:"CouchbaseOrm::NestedDocument"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"class Part < CouchbaseOrm::NestedDocument\n  attribute :name, :string\n  attribute :manufacturer, :string\nend\n\n# Define the Car model with a nested Part document\nclass Car < CouchbaseOrm::Base\n  attribute :make, :string\n  attribute :model, :string\n  attribute :year, :integer\n  attribute :parts, :array, type: Part\n\n  validates :make, presence: true\n  validates :model, presence: true\n  validates :year, presence: true\nend\n\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In this example, we define a ",(0,a.jsx)(t.code,{children:"Car"})," model with a nested ",(0,a.jsx)(t.code,{children:"Part"})," document. The ",(0,a.jsx)(t.code,{children:"Part"})," class inherits from ",(0,a.jsx)(t.code,{children:"CouchbaseOrm::NestedDocument"})," and defines attributes for ",(0,a.jsx)(t.code,{children:"name"})," and ",(0,a.jsx)(t.code,{children:"manufacturer"}),". The ",(0,a.jsx)(t.code,{children:"Car"})," model has an ",(0,a.jsx)(t.code,{children:"parts"})," attribute that is an array of ",(0,a.jsx)(t.code,{children:"Part"})," nested documents."]}),"\n",(0,a.jsx)(t.h2,{id:"92-embedding-documents",children:"9.2. Embedding Documents"}),"\n",(0,a.jsx)(t.p,{children:"To embed a document within a parent document, you can assign an instance of the nested document class to the corresponding attribute."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"# Create a new car with nested parts\ncar = Car.new(\n  make: 'Toyota',\n  model: 'Corolla',\n  year: 2022,\n  parts: [\n    Part.new(name: 'Engine', manufacturer: 'Toyota Motors'),\n    Part.new(name: 'Transmission', manufacturer: 'Toyota Motors')\n  ]\n)\ncar.save\n"})}),"\n",(0,a.jsxs)(t.p,{children:["When saving the parent document (",(0,a.jsx)(t.code,{children:"Car"}),"), CouchbaseOrm serializes the nested ",(0,a.jsx)(t.code,{children:"Part"})," documents and stores them within the parent document. This allows you to retrieve the entire data structure with a single query."]}),"\n",(0,a.jsx)(t.h2,{id:"93-accessing-nested-documents",children:"9.3. Accessing Nested Documents"}),"\n",(0,a.jsx)(t.p,{children:"To access an nested document, you can simply call the corresponding attribute on the parent document."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"toyota_cars = Car.where(make: 'Toyota')\n"})}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm automatically deserializes the nested document and returns an instance of the nested document class."}),"\n",(0,a.jsx)(t.h2,{id:"94-updating-nested-documents",children:"9.4. Updating Nested Documents"}),"\n",(0,a.jsx)(t.p,{children:"To update an nested document, you can modify the attributes of the nested document instance and save the parent document."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"engine_part = car.parts.find { |part| part.name == 'Engine' }\nengine_part.manufacturer = 'Toyota Industries'\ncar.save\n"})}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm will serialize the updated nested document and save it along with the parent document."}),"\n",(0,a.jsx)(t.h2,{id:"95-embedding-multiple-documents",children:"9.5. Embedding Multiple Documents"}),"\n",(0,a.jsx)(t.p,{children:"You can also embed multiple documents within a parent document using an array attribute."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"car = Car.new(\n  make: 'Toyota',\n  model: 'Corolla',\n  year: 2022,\n  parts: [\n    Part.new(name: 'Engine', manufacturer: 'Toyota Motors'),\n    Part.new(name: 'Transmission', manufacturer: 'Toyota Motors')\n  ]\n)\ncar.save\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In this example, the ",(0,a.jsx)(t.code,{children:"Car"})," model has an ",(0,a.jsx)(t.code,{children:"parts"})," attribute that is an array of ",(0,a.jsx)(t.code,{children:"Part"})," nested documents. You can embed multiple ",(0,a.jsx)(t.code,{children:"Part"})," documents within a single ",(0,a.jsx)(t.code,{children:"Car"})," document, allowing you to store related data together."]}),"\n",(0,a.jsx)(t.h2,{id:"96-querying-nested-documents",children:"9.6. Querying Nested Documents"}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm allows you to query nested documents using dot notation and attribute conditions."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"cars_by_part_manufacturer = Car.where(\"ANY part IN parts SATISFIES part.manufacturer = 'Toyota Industries' END\")\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This query retrieves all the ",(0,a.jsx)(t.code,{children:"Car"})," documents where at least one ",(0,a.jsx)(t.code,{children:"Part"})," document has a ",(0,a.jsx)(t.code,{children:"manufacturer"})," attribute equal to ",(0,a.jsx)(t.code,{children:"'Toyota Industries'"}),". You can use dot notation to access nested document attributes within the query condition."]}),"\n",(0,a.jsx)(t.h2,{id:"97-validating-nested-documents",children:"9.7. Validating Nested Documents"}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm allows you to validate nested documents along with the parent document."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"class Part < CouchbaseOrm::NestedDocument\n  attribute :name, :string\n  attribute :manufacturer, :string\n\n  validates :name, presence: true\n  validates :manufacturer, presence: true\nend\n\nclass Car < CouchbaseOrm::Base\n  attribute :make, :string\n  attribute :model, :string\n  attribute :year, :integer\n  attribute :parts, :array, type: Part\n\n  validates :make, presence: true\n  validates :model, presence: true\n  validates :year, presence: true\n  validates :parts, presence: true\nend\n\n\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In this example, we define validations for the ",(0,a.jsx)(t.code,{children:"Part"})," nested document, ensuring that the ",(0,a.jsx)(t.code,{children:"name"})," and ",(0,a.jsx)(t.code,{children:"manufacturer"})," attributes are present. We also add validations to the ",(0,a.jsx)(t.code,{children:"Car"})," model to ensure that the ",(0,a.jsx)(t.code,{children:"make"}),", ",(0,a.jsx)(t.code,{children:"model"}),", ",(0,a.jsx)(t.code,{children:"year"}),", and ",(0,a.jsx)(t.code,{children:"parts"})," attributes are present."]}),"\n",(0,a.jsxs)(t.p,{children:["When saving a ",(0,a.jsx)(t.code,{children:"Car"})," document, CouchbaseOrm will validate both the parent document and the nested ",(0,a.jsx)(t.code,{children:"Part"})," documents. If any validation fails, the parent document will not be saved, and validation errors will be added to the parent document."]}),"\n",(0,a.jsx)(t.p,{children:"Nested documents provide a powerful way to model complex data structures and relationships within a single Couchbase document. They allow you to store related data together, improving performance and reducing the need for separate queries to retrieve associated data."}),"\n",(0,a.jsx)(t.p,{children:"However, it's important to consider the trade-offs when using nested documents. Embedding too much data within a single document can lead to large document sizes and potential performance issues. It's recommended to use nested documents judiciously and to consider the access patterns and data relationships of your application."}),"\n",(0,a.jsx)(t.p,{children:"In the next section, we'll explore enums in CouchbaseOrm and how they can be used to define a fixed set of values for an attribute."})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>d,x:()=>o});var a=n(6540);const s={},r=a.createContext(s);function d(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);