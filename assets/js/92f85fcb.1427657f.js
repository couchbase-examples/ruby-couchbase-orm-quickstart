"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[702],{2573:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var t=i(4848),o=i(8453);const a={},s="Views (aka Map/Reduce indexes)",c={id:"tutorial-ruby-couchbase-orm/views",title:"Views (aka Map/Reduce indexes)",description:"Views are a powerful feature in Couchbase that allow you to define map functions to extract and emit specific data from your documents. The Ruby Couchbase ORM provides a convenient way to define and query views within your Ruby application.",source:"@site/docs/tutorial-ruby-couchbase-orm/08-views.md",sourceDirName:"tutorial-ruby-couchbase-orm",slug:"/tutorial-ruby-couchbase-orm/views",permalink:"/docs/tutorial-ruby-couchbase-orm/views",draft:!1,unlisted:!1,editUrl:"https://github.com/couchbase-examples/ruby-couchbase-orm-quickstart/tree/docs/docusaurus/docusaurus/docs/docs/tutorial-ruby-couchbase-orm/08-views.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"SQL++ (formerly N1QL) Queries",permalink:"/docs/tutorial-ruby-couchbase-orm/sqlpp-queries"},next:{title:"Nested Documents",permalink:"/docs/tutorial-ruby-couchbase-orm/nested-documents"}},r={},d=[{value:"8.1 Defining Views",id:"81-defining-views",level:2},{value:"8.2 Custom Map Functions",id:"82-custom-map-functions",level:2},{value:"8.3 Querying Views",id:"83-querying-views",level:2},{value:"8.4 Indexing Views",id:"84-indexing-views",level:2},{value:"8.5 Conclusion",id:"85-conclusion",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"views-aka-mapreduce-indexes",children:"Views (aka Map/Reduce indexes)"}),"\n",(0,t.jsx)(n.p,{children:"Views are a powerful feature in Couchbase that allow you to define map functions to extract and emit specific data from your documents. The Ruby Couchbase ORM provides a convenient way to define and query views within your Ruby application."}),"\n",(0,t.jsx)(n.h2,{id:"81-defining-views",children:"8.1 Defining Views"}),"\n",(0,t.jsxs)(n.p,{children:["To define a view in your Ruby Couchbase ORM model, you can use the ",(0,t.jsx)(n.code,{children:"view"})," method followed by the view name and options. Here's an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"class Factory < CouchbaseOrm::Base\n  attribute :name, type: String\n  attribute :location, type: String\n  attribute :established_year, type: Integer\n  attribute :active, type: Boolean\n\n  view :by_name, emit_key: :name\n  view :by_location, emit_key: :location\n  view :by_established_year, emit_key: :established_year\n  view :by_active, emit_key: :active\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In this example, we define four views for the ",(0,t.jsx)(n.code,{children:"Factory"})," model:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"by_name"}),": Emits the ",(0,t.jsx)(n.code,{children:"name"})," attribute as the key."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"by_location"}),": Emits the ",(0,t.jsx)(n.code,{children:"location"})," attribute as the key."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"by_established_year"}),": Emits the ",(0,t.jsx)(n.code,{children:"established_year"})," attribute as the key."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"by_active"}),": Emits the ",(0,t.jsx)(n.code,{children:"active"})," attribute as the key."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"emit_key"})," option specifies the attribute to use as the key for the view."]}),"\n",(0,t.jsx)(n.h2,{id:"82-custom-map-functions",children:"8.2 Custom Map Functions"}),"\n",(0,t.jsxs)(n.p,{children:["You can also define custom map functions for your views using the ",(0,t.jsx)(n.code,{children:"map"})," option. This allows you to emit custom keys and values based on your specific requirements. Here's an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'view :by_name_and_location,\n  map: %{\n    function(doc) {\n      if (doc.type === "factory") {\n        emit([doc.name, doc.location], null);\n      }\n    }\n  }\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In this example, we define a view named ",(0,t.jsx)(n.code,{children:"by_name_and_location"})," that emits a composite key consisting of the ",(0,t.jsx)(n.code,{children:"name"})," and ",(0,t.jsx)(n.code,{children:"location"})," attributes."]}),"\n",(0,t.jsx)(n.h2,{id:"83-querying-views",children:"8.3 Querying Views"}),"\n",(0,t.jsx)(n.p,{children:"Once you have defined your views, you can query them using the corresponding view methods. The view methods are automatically generated based on the view names. Here are some examples:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'# Query factories by name\nFactory.by_name(key: \'Factory A\').each do |factory|\n  puts "- #{factory.name}"\nend\n\n# Query factories by location\nFactory.by_location(key: \'City X\').each do |factory|\n  puts "- #{factory.name}"\nend\n\n# Query factories by established year\nFactory.by_established_year(key: 2010).each do |factory|\n  puts "- #{factory.name}"\nend\n\n# Query active factories\nFactory.by_active(key: true).each do |factory|\n  puts "- #{factory.name}"\nend\n'})}),"\n",(0,t.jsx)(n.p,{children:"These examples demonstrate how to query views based on specific keys using the generated view methods."}),"\n",(0,t.jsx)(n.h2,{id:"84-indexing-views",children:"8.4 Indexing Views"}),"\n",(0,t.jsxs)(n.p,{children:["In this section, let's explore the ",(0,t.jsx)(n.code,{children:"index_view"})," function and the methods it generates for the ",(0,t.jsx)(n.code,{children:"location"})," attribute."]}),"\n",(0,t.jsxs)(n.p,{children:["Here's an updated version of the ",(0,t.jsx)(n.code,{children:"Factory"})," model using ",(0,t.jsx)(n.code,{children:"index_view"})," for the ",(0,t.jsx)(n.code,{children:"location"})," attribute:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'class Factory < CouchbaseOrm::Base\n  attribute :name, type: String\n  attribute :location, type: String\n  attribute :established_year, type: Integer\n  attribute :active, type: Boolean\n\n  view :by_name, emit_key: :name\n  index_view :location\n  view :by_established_year, emit_key: :established_year\n  view :by_active, emit_key: :active\n\n  view :by_name_and_location,\n    map: %{\n      function(doc) {\n        if (doc.type === "factory") {\n          emit([doc.name, doc.location], null);\n        }\n      }\n    }\n\n  view :by_established_year_range,\n    map: %{\n      function(doc) {\n        if (doc.type === "factory" && doc.established_year) {\n          emit(doc.established_year, null);\n        }\n      }\n    }\nend\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In this updated code, we replaced ",(0,t.jsx)(n.code,{children:"view :by_location, emit_key: :location"})," with ",(0,t.jsx)(n.code,{children:"index_view :location"}),". The ",(0,t.jsx)(n.code,{children:"index_view"})," function generates two methods for querying based on the ",(0,t.jsx)(n.code,{children:"location"})," attribute:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"find_by_location(location)"}),": This method allows you to find factories by a specific location. It returns an array of factories that match the given location."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"by_location(key: location)"}),": This method is similar to ",(0,t.jsx)(n.code,{children:"find_by_location"})," but returns a ",(0,t.jsx)(n.code,{children:"CouchbaseOrm::ResultsProxy"})," object, which provides an enumerable interface to access the view results."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Now, let's see how we can use these generated methods to query factories by location:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"# Find factories by location using find_by_location\nfactories = Factory.find_by_location('City X')\nfactories.each do |factory|\n  puts \"- #{factory.name} (#{factory.location})\"\nend\n\n# Find factories by location using by_location\nFactory.by_location(key: 'City X').each do |factory|\n  puts \"- #{factory.name} (#{factory.location})\"\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Both ",(0,t.jsx)(n.code,{children:"find_by_location"})," and ",(0,t.jsx)(n.code,{children:"by_location"})," achieve the same result of finding factories by a specific location. The difference is that ",(0,t.jsx)(n.code,{children:"find_by_location"})," returns an array of factories directly, while ",(0,t.jsx)(n.code,{children:"by_location"})," returns a ",(0,t.jsx)(n.code,{children:"CouchbaseOrm::ResultsProxy"})," object that you can further chain or iterate over."]}),"\n",(0,t.jsxs)(n.p,{children:["Using ",(0,t.jsx)(n.code,{children:"index_view"})," provides a convenient way to generate commonly used query methods for a specific attribute. It simplifies the process of querying based on that attribute and enhances the readability of your code."]}),"\n",(0,t.jsx)(n.h2,{id:"85-conclusion",children:"8.5 Conclusion"}),"\n",(0,t.jsx)(n.p,{children:"Views in the Ruby Couchbase ORM provide a powerful way to define and query data based on specific attributes and custom map functions. By defining views, you can easily retrieve subsets of your data and perform efficient queries based on your application's requirements."}),"\n",(0,t.jsxs)(n.p,{children:["Remember to ensure that your design documents are up to date by calling ",(0,t.jsx)(n.code,{children:"ensure_design_document!"})," on your models before running queries."]}),"\n",(0,t.jsx)(n.p,{children:"With the flexibility and ease of use provided by the Ruby Couchbase ORM's view functionality, you can efficiently query and retrieve data from your Couchbase database."})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>c});var t=i(6540);const o={},a=t.createContext(o);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);