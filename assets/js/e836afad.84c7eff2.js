"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[657],{4071:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var a=n(4848),s=n(8453);const i={},r="Defining Models",d={id:"tutorial-ruby-couchbase-orm/defining-models",title:"Defining Models",description:"In CouchbaseOrm, models are defined as Ruby classes that inherit from CouchbaseOrm::Base. Each model represents a document type in Couchbase Server and encapsulates the data and behavior of the objects in your application.",source:"@site/docs/tutorial-ruby-couchbase-orm/03-defining-models.md",sourceDirName:"tutorial-ruby-couchbase-orm",slug:"/tutorial-ruby-couchbase-orm/defining-models",permalink:"/docs/tutorial-ruby-couchbase-orm/defining-models",draft:!1,unlisted:!1,editUrl:"https://github.com/couchbase-examples/ruby-couchbase-orm-quickstart/tree/docs/docusaurus/docusaurus/docs/docs/tutorial-ruby-couchbase-orm/03-defining-models.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Installation",permalink:"/docs/tutorial-ruby-couchbase-orm/installation"},next:{title:"Querying",permalink:"/docs/tutorial-ruby-couchbase-orm/querying"}},l={},c=[{value:"3.1. Creating a Model",id:"31-creating-a-model",level:2},{value:"3.2. Attribute Types",id:"32-attribute-types",level:2},{value:"3.3. Attribute Options",id:"33-attribute-options",level:2},{value:"3.4. Timestamps",id:"34-timestamps",level:2},{value:"3.5. Callbacks",id:"35-callbacks",level:2},{value:"3.6. Validations",id:"36-validations",level:2}];function o(e){const t={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"defining-models",children:"Defining Models"}),"\n",(0,a.jsxs)(t.p,{children:["In CouchbaseOrm, models are defined as Ruby classes that inherit from ",(0,a.jsx)(t.code,{children:"CouchbaseOrm::Base"}),". Each model represents a document type in Couchbase Server and encapsulates the data and behavior of the objects in your application."]}),"\n",(0,a.jsx)(t.h2,{id:"31-creating-a-model",children:"3.1. Creating a Model"}),"\n",(0,a.jsxs)(t.p,{children:["To create a model, define a new class that inherits from ",(0,a.jsx)(t.code,{children:"CouchbaseOrm::Base"}),". For example, let's create a ",(0,a.jsx)(t.code,{children:"User"})," model:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\nend\n"})}),"\n",(0,a.jsxs)(t.p,{children:["By convention, CouchbaseOrm uses the underscored, pluralized name of the class as the document type in Couchbase Server. In this case, the document type for the ",(0,a.jsx)(t.code,{children:"User"})," model would be ",(0,a.jsx)(t.code,{children:"users"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"32-attribute-types",children:"3.2. Attribute Types"}),"\n",(0,a.jsxs)(t.p,{children:["CouchbaseOrm supports various attribute types to define the structure and types of your model's data. You can specify the attributes of your model using the ",(0,a.jsx)(t.code,{children:"attribute"})," method."]}),"\n",(0,a.jsxs)(t.p,{children:["Here's an example of defining attributes in the ",(0,a.jsx)(t.code,{children:"User"})," model:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  attribute :email, :string\n  attribute :name, :string\n  attribute :age, :integer\n  attribute :height, :float\n  attribute :is_active, :boolean\n  attribute :birth_date, :date\n  attribute :created_at, :datetime\n  attribute :updated_at, :datetime\n  attribute :appointment_time, :time\n  attribute :hobbies, :array, type: :string\n  attribute :metadata, type: Hash\n  attribute :avatar, :binary\n\n  attribute :created_at, :datetime\n  attribute :updated_at, :datetime\nend\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In this example, we define several attributes for the ",(0,a.jsx)(t.code,{children:"User"})," model, each with a specific type. The supported attribute types in CouchbaseOrm include:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":string"}),": Represents a string value."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":integer"}),": Represents an integer value."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":float"}),": Represents a floating-point value."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":boolean"}),": Represents a boolean value."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":date"}),": Represents a date value."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":datetime"}),": Represents a date and time value."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":time"}),": Represents a time value."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":array"}),": Represents an array of values."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:":binary"}),": Represents a binary data value."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"Hash"}),": Represents a hash (dictionary) of key-value pairs."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm automatically handles the serialization and deserialization of these attribute types when storing and retrieving documents from Couchbase Server."}),"\n",(0,a.jsx)(t.h2,{id:"33-attribute-options",children:"3.3. Attribute Options"}),"\n",(0,a.jsx)(t.p,{children:"In addition to specifying the attribute type, you can also provide additional options to customize the behavior of the attributes. Some commonly used options include:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"default"}),": Specifies a default value for the attribute if no value is provided."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Here's an example of using attribute options:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  attribute :name, :string, default: 'Unknown'\nend\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In this example, the ",(0,a.jsx)(t.code,{children:"name"})," attribute has a default value of ",(0,a.jsx)(t.code,{children:"'Unknown'"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"34-timestamps",children:"3.4. Timestamps"}),"\n",(0,a.jsxs)(t.p,{children:["CouchbaseOrm provides built-in support for timestamp attributes. By default, if you define attributes named ",(0,a.jsx)(t.code,{children:"created_at"})," and ",(0,a.jsx)(t.code,{children:"updated_at"})," with the ",(0,a.jsx)(t.code,{children:":datetime"})," type, CouchbaseOrm will automatically populate these attributes with the current date and time when a document is created or updated. To enable this feature, add the ",(0,a.jsx)(t.code,{children:"created_at"})," and ",(0,a.jsx)(t.code,{children:"updated_at"})," attributes to your model.The fields are automatically updated when the document is saved.",(0,a.jsx)(t.code,{children:"document.save"})]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  attribute :created_at, :datetime\n  attribute :updated_at, :datetime\nend\n"})}),"\n",(0,a.jsx)(t.p,{children:"With these timestamp attributes defined, CouchbaseOrm will manage them automatically whenever a document is persisted or updated."}),"\n",(0,a.jsx)(t.h2,{id:"35-callbacks",children:"3.5. Callbacks"}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm supports lifecycle callbacks that allow you to execute code at certain points in a document's lifecycle. Callbacks can be used to perform actions before or after specific events, such as saving or updating a document."}),"\n",(0,a.jsx)(t.p,{children:"Here are some commonly used callbacks:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"before_create"}),": Runs before a new document is created."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"after_create"}),": Runs after a new document is created."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"before_save"}),": Runs before a document is saved (either created or updated)."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"after_save"}),": Runs after a document is saved (either created or updated)."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"before_update"}),": Runs before an existing document is updated."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"after_update"}),": Runs after an existing document is updated."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"before_destroy"}),": Runs before a document is destroyed."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"after_destroy"}),": Runs after a document is destroyed."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"To define a callback, use the corresponding callback method and provide a block or method name to be executed. For example:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:'class Document < CouchbaseOrm::Base\n  attribute :title, :string\n  attribute :content, :string\n\n  before_create :before_create_callback\n  after_create :after_create_callback\n  before_save :before_save_callback\n  after_save :after_save_callback\n  before_update :before_update_callback\n  after_update :after_update_callback\n  before_destroy :before_destroy_callback\n  after_destroy :after_destroy_callback\n\n  private\n\n  def before_create_callback\n    puts "Running before_create callback for #{title}"\n  end\n\n  def after_create_callback\n    puts "Running after_create callback for #{title}"\n  end\n\n  def before_save_callback\n    puts "Running before_save callback for #{title}"\n  end\n\n  def after_save_callback\n    puts "Running after_save callback for #{title}"\n  end\n\n  def before_update_callback\n    puts "Running before_update callback for #{title}"\n  end\n\n  def after_update_callback\n    puts "Running after_update callback for #{title}"\n  end\n\n  def before_destroy_callback\n    puts "Running before_destroy callback for #{title}"\n  end\n\n  def after_destroy_callback\n    puts "Running after_destroy callback for #{title}"\n  end\nend\n'})}),"\n",(0,a.jsxs)(t.p,{children:["In this example, the ",(0,a.jsx)(t.code,{children:"Document"})," model defines several callbacks that are triggered at different points in the document's lifecycle. The callback methods are implemented as private instance methods within the model class."]}),"\n",(0,a.jsx)(t.p,{children:"Callbacks allow you to encapsulate logic related to the document lifecycle and maintain a clean and organized codebase."}),"\n",(0,a.jsx)(t.h2,{id:"36-validations",children:"3.6. Validations"}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm includes built-in validation capabilities to ensure the integrity and validity of your data before persisting it to Couchbase Server. Validations help you enforce business rules and constraints on your models."}),"\n",(0,a.jsxs)(t.p,{children:["To define validations, use the ",(0,a.jsx)(t.code,{children:"validates"})," method followed by the attribute name and the desired validation rules. For example:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"class Book < CouchbaseOrm::Base\n  attribute :title, :string\n  attribute :author, :string\n  attribute :pages, :integer\n  attribute :genre, :string\n  attribute :email, :string\n\n  validates_presence_of :title\n  validates :author, presence: true\n  validates :pages, numericality: { greater_than: 0 }\n  validates :genre, inclusion: { in: %w[Fiction Non-Fiction] }\n  validates :author, format: { with: /\\A[a-zA-Z]+\\z/, message: 'only allows letters' }\n  validates :pages, length: { maximum: 500 }\n  validates :genre, exclusion: { in: %w[Science-Fiction] }\n  validates :email, format: { with: /\\A[\\w+\\-.]+@[a-z\\d\\-]+(\\.[a-z\\d\\-]+)*\\.[a-z]+\\z/i }\n\n  validate :custom_validation\n\n  private\n\n  ...\nend\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In this example, we define several validations for the ",(0,a.jsx)(t.code,{children:"User"})," model:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["The ",(0,a.jsx)(t.code,{children:"name"})," attribute must be present."]}),"\n",(0,a.jsxs)(t.li,{children:["The ",(0,a.jsx)(t.code,{children:"email"})," attribute must match a specific format (a valid email address)."]}),"\n",(0,a.jsxs)(t.li,{children:["The ",(0,a.jsx)(t.code,{children:"age"})," attribute must be a number greater than or equal to 18."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"CouchbaseOrm provides a wide range of built-in validation helpers, such as:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"presence"}),": Ensures that the attribute is not blank."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"validates_presence_of"}),": An alias for ",(0,a.jsx)(t.code,{children:"presence"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"format"}),": Validates the attribute value against a regular expression."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"length"}),": Validates the length of the attribute value."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"numericality"}),": Validates that the attribute value is a valid number."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"inclusion"}),": Ensures that the attribute value is included in a given set."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"exclusion"}),": Ensures that the attribute value is not included in a given set."]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["You can also define custom validation methods by adding methods to your model class and using the ",(0,a.jsx)(t.code,{children:"validate"})," method to trigger them. For example:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ruby",children:"class Book < CouchbaseOrm::Base\n  attribute :title, :string\n  ...\n\n  validate :custom_validation\n\n  private\n\n  def custom_validation\n    puts 'Running custom validation...'\n    if title&.include?('Funny')\n      errors.add(:title, 'should not contain the word \"Funny\"')\n    else\n      # print the title\n      puts \"Title: #{title}\"\n      puts 'Custom validation passed'\n    end\n  end\nend\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In this example, the ",(0,a.jsx)(t.code,{children:"custom_validation"})," method is called during the validation process, and if ",(0,a.jsx)(t.code,{children:"some_condition"})," is met, an error is added to the model's ",(0,a.jsx)(t.code,{children:"errors"})," collection."]}),"\n",(0,a.jsxs)(t.p,{children:["Validations are automatically run when saving a document. If any validations fail, the save operation will be aborted, and the model's ",(0,a.jsx)(t.code,{children:"errors"})," collection will contain the validation error messages."]}),"\n",(0,a.jsx)(t.p,{children:"By leveraging validations, you can ensure the quality and consistency of your data before it is persisted to Couchbase Server."}),"\n",(0,a.jsx)(t.p,{children:"With the model definition covered, including attributes, callbacks, and validations, you're ready to start querying and persisting data using CouchbaseOrm. In the next section, we'll explore the querying capabilities of CouchbaseOrm and how to retrieve data from Couchbase Server efficiently."})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>d});var a=n(6540);const s={},i=a.createContext(s);function r(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);