"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[913],{3913:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var a=s(4848),o=s(8453);const r={},t="Advanced Topics",i={id:"tutorial-ruby-couchbase-orm/advanced-topics",title:"Advanced Topics",description:"In this section, we'll explore some advanced topics in CouchbaseOrm, including transactions, concurrency, error handling, and extending CouchbaseOrm.",source:"@site/docs/tutorial-ruby-couchbase-orm/14-advanced-topics.md",sourceDirName:"tutorial-ruby-couchbase-orm",slug:"/tutorial-ruby-couchbase-orm/advanced-topics",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/advanced-topics",draft:!1,unlisted:!1,editUrl:"https://github.com/couchbase-examples/ruby-couchbase-orm-quickstart/tree/docs/docusaurus/docusaurus/docs/docs/tutorial-ruby-couchbase-orm/14-advanced-topics.md",tags:[],version:"current",sidebarPosition:14,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Testing",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/testing"},next:{title:"Troubleshooting",permalink:"/ruby-couchbase-orm-quickstart/docs/tutorial-ruby-couchbase-orm/troubleshooting"}},c={},d=[{value:"14.1. Transactions",id:"141-transactions",level:2},{value:"14.2. Concurrency",id:"142-concurrency",level:2},{value:"14.3. Error Handling",id:"143-error-handling",level:2},{value:"14.4. Extending CouchbaseOrm",id:"144-extending-couchbaseorm",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"advanced-topics",children:"Advanced Topics"}),"\n",(0,a.jsx)(n.p,{children:"In this section, we'll explore some advanced topics in CouchbaseOrm, including transactions, concurrency, error handling, and extending CouchbaseOrm."}),"\n",(0,a.jsx)(n.h2,{id:"141-transactions",children:"14.1. Transactions"}),"\n",(0,a.jsx)(n.p,{children:"Transactions allow you to group multiple database operations into a single atomic unit of work. If any operation within the transaction fails, all the changes made within the transaction are rolled back, ensuring data integrity and consistency."}),"\n",(0,a.jsxs)(n.p,{children:["CouchbaseOrm supports transactions through the ",(0,a.jsx)(n.code,{children:"CouchbaseOrm.transaction"})," method. Here's an example of using transactions:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ruby",children:"CouchbaseOrm.transaction do\n  user = User.create(name: 'John Doe', email: 'john@example.com')\n  account = Account.create(user: user, balance: 100)\n  # ...\nend\n"})}),"\n",(0,a.jsx)(n.p,{children:"In this example, the creation of a user and an account are wrapped inside a transaction. If any operation within the transaction fails, all the changes made within the transaction will be rolled back, ensuring that the database remains in a consistent state."}),"\n",(0,a.jsx)(n.p,{children:"Transactions are useful when you need to perform multiple related operations that should succeed or fail together, such as creating related records or updating multiple documents atomically."}),"\n",(0,a.jsx)(n.h2,{id:"142-concurrency",children:"14.2. Concurrency"}),"\n",(0,a.jsx)(n.p,{children:"Concurrency refers to the ability of multiple processes or threads to access and manipulate data simultaneously. When working with a distributed database like Couchbase, it's important to consider concurrency and handle potential conflicts."}),"\n",(0,a.jsx)(n.p,{children:"CouchbaseOrm provides several mechanisms to handle concurrency:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Optimistic Locking"}),": CouchbaseOrm uses optimistic locking by default. Each document has a CAS (Compare and Swap) value that is checked during updates. If the CAS value has changed since the document was retrieved, indicating that another process has modified the document, an exception is raised, and the update fails."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Pessimistic Locking"}),": Pessimistic locking can be achieved by using the ",(0,a.jsx)(n.code,{children:"with_lock"})," method. It ensures that a document is locked while being accessed, preventing other processes from modifying it until the lock is released."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ruby",children:"user = User.with_lock.find('user_id')\n# Perform updates on the user\nuser.save\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Atomic Operations"}),": CouchbaseOrm supports atomic operations, such as ",(0,a.jsx)(n.code,{children:"increment"}),", ",(0,a.jsx)(n.code,{children:"decrement"}),", and ",(0,a.jsx)(n.code,{children:"touch"}),", which allow you to perform specific operations on a document without the need for explicit locking."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ruby",children:"user = User.find('user_id')\nuser.increment(:login_count)\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"When designing your application, consider the concurrency requirements and choose the appropriate locking and synchronization mechanisms to ensure data integrity and avoid conflicts."}),"\n",(0,a.jsx)(n.h2,{id:"143-error-handling",children:"14.3. Error Handling"}),"\n",(0,a.jsx)(n.p,{children:"Proper error handling is crucial for building robust and resilient applications. CouchbaseOrm provides a set of exception classes that you can catch and handle in your code."}),"\n",(0,a.jsx)(n.p,{children:"Some common exceptions in CouchbaseOrm include:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"CouchbaseOrm::Error::DocumentNotFound"}),": Raised when a requested document is not found in the database."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"CouchbaseOrm::Error::DocumentInvalid"}),": Raised when a document fails validation before being saved."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"CouchbaseOrm::Error::DocumentConflict"}),": Raised when there is a conflict during an update operation, indicating that the document has been modified by another process."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"You can catch and handle these exceptions to provide appropriate error responses or perform alternative actions:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ruby",children:"begin\n  user = User.find('non_existent_id')\nrescue CouchbaseOrm::Error::DocumentNotFound\n  # Handle the case when the user is not found\n  # ...\nend\n"})}),"\n",(0,a.jsx)(n.p,{children:"It's important to handle exceptions gracefully, provide meaningful error messages to users, and log exceptions for debugging and monitoring purposes."}),"\n",(0,a.jsx)(n.h2,{id:"144-extending-couchbaseorm",children:"14.4. Extending CouchbaseOrm"}),"\n",(0,a.jsx)(n.p,{children:"CouchbaseOrm is designed to be extensible, allowing you to customize and extend its behavior to fit your application's specific needs."}),"\n",(0,a.jsx)(n.p,{children:"Here are a few ways you can extend CouchbaseOrm:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Custom Plugins"}),": You can create custom plugins to add new functionality or modify existing behavior in CouchbaseOrm. Plugins can be used to define new query methods, add custom validations, or integrate with external libraries."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ruby",children:"module MyCustomPlugin\n  module ClassMethods\n    def by_email(email)\n      where(email: email).first\n    end\n  end\n\n  def self.included(base)\n    base.extend ClassMethods\n  end\nend\n\nclass User < CouchbaseOrm::Base\n  include MyCustomPlugin\nend\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Callbacks"}),": CouchbaseOrm provides a set of callbacks that you can use to hook into the lifecycle of your models. You can define custom callbacks to perform additional actions before or after certain events, such as saving or updating a document."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ruby",children:"class User < CouchbaseOrm::Base\n  before_save :encrypt_password\n\n  private\n\n  def encrypt_password\n    self.password = encrypt(password) if password_changed?\n  end\nend\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Inheritance and Mixins"}),": You can use inheritance and mixins to share common behavior across multiple models. By defining a base model or a mixin module, you can encapsulate reusable code and keep your models DRY."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ruby",children:"module Timestamps\n  def self.included(base)\n    base.attribute :created_at, :datetime\n    base.attribute :updated_at, :datetime\n\n    base.before_create :set_created_at\n    base.before_update :set_updated_at\n  end\n\n  private\n\n  def set_created_at\n    self.created_at = Time.now\n  end\n\n  def set_updated_at\n    self.updated_at = Time.now\n  end\nend\n\nclass User < CouchbaseOrm::Base\n  include Timestamps\nend\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Extending CouchbaseOrm allows you to tailor it to your application's specific requirements and add custom functionality that aligns with your business logic."}),"\n",(0,a.jsx)(n.p,{children:"Remember to keep your extensions modular, maintainable, and well-tested to ensure the stability and reliability of your application."}),"\n",(0,a.jsx)(n.p,{children:"In the next section, we'll explore troubleshooting techniques and common issues that you may encounter while working with CouchbaseOrm."})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>i});var a=s(6540);const o={},r=a.createContext(o);function t(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);