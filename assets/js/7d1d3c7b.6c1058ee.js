"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[216],{3015:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>l,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var r=t(4848),i=t(8453);const a={},s="Encryption",o={id:"tutorial-ruby-couchbase-orm/encryption",title:"Encryption",description:"CouchbaseOrm provides built-in support for encrypting sensitive data stored in your Couchbase documents. Encryption allows you to protect confidential information, such as personal data or financial details, by encrypting the values before storing them in the database and decrypting them when retrieving the data.",source:"@site/docs/tutorial-ruby-couchbase-orm/11-encryption.md",sourceDirName:"tutorial-ruby-couchbase-orm",slug:"/tutorial-ruby-couchbase-orm/encryption",permalink:"/docs/tutorial-ruby-couchbase-orm/encryption",draft:!1,unlisted:!1,editUrl:"https://github.com/couchbase-examples/ruby-couchbase-orm-quickstart/tree/docs/docusaurus/docusaurus/docs/docs/tutorial-ruby-couchbase-orm/11-encryption.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Enums",permalink:"/docs/tutorial-ruby-couchbase-orm/enums"},next:{title:"Logging",permalink:"/docs/tutorial-ruby-couchbase-orm/logging"}},c={},d=[{value:"11.1. Encrypted Attributes",id:"111-encrypted-attributes",level:2},{value:"11.2. Encryption Process",id:"112-encryption-process",level:2},{value:"11.3. Encryption and Decryption Process",id:"113-encryption-and-decryption-process",level:2},{value:"11.4. Considerations and Best Practices",id:"114-considerations-and-best-practices",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"encryption",children:"Encryption"}),"\n",(0,r.jsx)(n.p,{children:"CouchbaseOrm provides built-in support for encrypting sensitive data stored in your Couchbase documents. Encryption allows you to protect confidential information, such as personal data or financial details, by encrypting the values before storing them in the database and decrypting them when retrieving the data."}),"\n",(0,r.jsx)(n.h2,{id:"111-encrypted-attributes",children:"11.1. Encrypted Attributes"}),"\n",(0,r.jsxs)(n.p,{children:["To mark an attribute as encrypted, you can use the ",(0,r.jsx)(n.code,{children:":encrypted"})," type when defining the attribute in your model."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",children:'# Define the Bank model with an encrypted attribute\nclass Bank < CouchbaseOrm::Base\n  attribute :name, :string\n  attribute :account_number, :encrypted\n  attribute :routing_number, :encrypted, alg: "3DES"\nend\n'})}),"\n",(0,r.jsxs)(n.p,{children:["In this example, the ",(0,r.jsx)(n.code,{children:"account_number"})," and ",(0,r.jsx)(n.code,{children:"routing_number"})," attributes are marked as encrypted. By default, CouchbaseOrm uses the default ",(0,r.jsx)(n.code,{children:"CB_MOBILE_CUSTOM"})," encryption algorithm for encrypting the values. You can specify a different encryption algorithm by providing the ",(0,r.jsx)(n.code,{children:"alg"})," option."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'{\n  "name": "Test Bank",\n  "encrypted$account_number": {\n    "alg": "CB_MOBILE_CUSTOM",\n    "ciphertext": "MTIzNDU2Nzg5"\n  },\n  "encrypted$routing_number": {\n    "alg": "3DES",\n    "ciphertext": "OTg3NjU0MzIx"\n  },\n  "type": "bank"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["When a document is saved, CouchbaseOrm stores the encrypted values in the document with a prefix of ",(0,r.jsx)(n.code,{children:"encrypted$"}),". The encrypted values are stored as JSON objects containing the encryption algorithm (",(0,r.jsx)(n.code,{children:"alg"}),") and the ciphertext (",(0,r.jsx)(n.code,{children:"ciphertext"}),") of the encrypted value."]}),"\n",(0,r.jsx)(n.p,{children:"You can assign values to encrypted attributes just like any other attribute."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",children:"bank = Bank.new(name: 'My Bank', account_number: '123456789', routing_number: '987654321')\n"})}),"\n",(0,r.jsxs)(n.p,{children:["When the document is saved, CouchbaseOrm encrypts the value of ",(0,r.jsx)(n.code,{children:"ssn"})," using the configured encryption key."]}),"\n",(0,r.jsx)(n.h2,{id:"112-encryption-process",children:"11.2. Encryption Process"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",children:'require \'base64\'\nrequire \'logger\'\n\nBank.all.each(&:destroy)\n\n# Method to print serialized attributes\ndef expect_serialized_attributes(bank)\n  serialized_attrs = bank.send(:serialized_attributes)\n  serialized_attrs.each do |key, value|\n    puts "#{key}: #{value}"\n  end\n  json_attrs = JSON.parse(bank.to_json)\n  json_attrs.each do |key, value|\n    puts "#{key}: #{value}"\n  end\n  bank.as_json.each do |key, value|\n    puts "#{key}: #{value}"\n  end\nend\n\n# Create a new bank record with encrypted attributes\nbank = Bank.new(\n  name: "Test Bank",\n  account_number: Base64.strict_encode64("123456789"),\n  routing_number: Base64.strict_encode64("987654321")\n)\n\n# Print serialized attributes before saving\nexpect_serialized_attributes(bank)\n\n# Save the bank record to Couchbase\nbank.save!\n\n# Reload the bank record from Couchbase\nbank.reload\n\n# Print serialized attributes after reloading\nexpect_serialized_attributes(bank)\n\n# Find the bank record by ID\nfound_bank = Bank.find(bank.id)\n\n# Print serialized attributes after finding\nexpect_serialized_attributes(found_bank)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"113-encryption-and-decryption-process",children:"11.3. Encryption and Decryption Process"}),"\n",(0,r.jsx)(n.p,{children:"When an encrypted attribute is assigned a value, CouchbaseOrm encrypts the value using the configured encryption key and algorithm. The encrypted value is then stored in the Couchbase document."}),"\n",(0,r.jsx)(n.p,{children:"When retrieving a document with encrypted attributes, CouchbaseOrm automatically decrypts the encrypted values using the same encryption key and algorithm. The decrypted values are then accessible through the model's attributes."}),"\n",(0,r.jsx)(n.p,{children:"It's important to keep the encryption key secure and protect it from unauthorized access. If the encryption key is compromised, the encrypted data can be decrypted by anyone who obtains the key."}),"\n",(0,r.jsx)(n.h2,{id:"114-considerations-and-best-practices",children:"11.4. Considerations and Best Practices"}),"\n",(0,r.jsx)(n.p,{children:"When using encryption in CouchbaseOrm, consider the following best practices:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keep the encryption key secure and protect it from unauthorized access. Store the key securely and avoid committing it to version control systems."}),"\n",(0,r.jsx)(n.li,{children:"Use strong and unique encryption keys for each environment (development, staging, production) to prevent cross-environment access to encrypted data."}),"\n",(0,r.jsx)(n.li,{children:"Be cautious when querying encrypted attributes as it may impact performance. Consider indexing encrypted attributes separately if frequent querying is required."}),"\n",(0,r.jsx)(n.li,{children:"If you need to search or query encrypted data frequently, consider using a separate encrypted search index or a dedicated encryption service."}),"\n",(0,r.jsx)(n.li,{children:"Ensure that the encryption key is properly rotated and managed. If the encryption key is compromised, you should generate a new key and re-encrypt the affected data."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Encryption is a powerful tool for protecting sensitive data, but it should be used judiciously. Encrypting every attribute in your model may not be necessary or practical. Focus on encrypting the most sensitive and confidential data while balancing the trade-offs between security and performance."}),"\n",(0,r.jsx)(n.p,{children:"In the next section, we'll explore logging in CouchbaseOrm and how you can configure and customize logging to monitor and debug your application."})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var r=t(6540);const i={},a=r.createContext(i);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);